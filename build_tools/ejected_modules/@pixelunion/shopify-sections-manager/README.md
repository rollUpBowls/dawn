# Shopify Sections Manager

The Shopify Sections Manager is a plugin for passing data from Liquid files and registering Shopify Section events in standard functions which can be called in the theme's section Javascript classes.

- [Installation](#installation)
- [Usage](#usage)
  - [Liquid](#liquid)
  - [Javascript](#javascript)
    - [Registering a Section](#registering-a-section)
    - [Section Callback Parameters](#section-callback-parameters)
    - [Event Handler Parameters](#event-handler-parameters)
    - [Lazy Initializing Sections](#lazy-initialize-sections)

## Installation

`npm install pixelunion/shopify-sections-manager`

## Usage

Shopify section events are bound to functions as follows:

Shopify Event | Function
---|---
`shopify:section:load`| Creates new section instance
`shopify:section:unload` | `onSectionUnload()`
`shopify:section:select` | `onSectionSelect()`
`shopify:section:deselect` | `onSectionDeselect()`
`shopify:section:reorder` | `onSectionReorder()`
`shopify:block:select` | `onSectionBlockSelect()`
`shopify:block:deselect` | `onSectionBlockDeselect()`

Section events are documented by Shopify [here](https://help.shopify.com/en/themes/development/sections)

## Liquid

The Liquid markup for the section must include a script tag with the following attributes:

Attribute | Description
---|---
`data-section-type` | Corresponds to the first parameter passed to `sections.register` when registering the section handler
`data-section-id` | The section id passed as a string
`data-section-data` | Optional and only needs to be included if you are passing additional information to the section script in the section.data argument. Additional section data must be passed in JSON format between the script tags.

### Example
```html
<!-- dynamic-slideshow.liquid -->
<script
  type="application/json"
  data-section-type="dynamic-slideshow"
  data-section-id="{{ section.id }}"
  data-section-data
>
{
    "autoplay": {{ section.settings.autoplay }},
    "autoplayDelay": {{ section.settings.autoplay_delay }},
    "autoplayHoverPause": {{ section.settings.autoplay-hover-pause }}
  }
</script>

[...]
```

## Javascript

In the Javascript file where you plan to initialize all of your section classes, create an instance of the Shopify Sections Manager:

```js
// ThemeView.js
import ShopifySectionsManager from 'shopify-sections-manager';
import DynamicSlideshow from './sections/DynamicSlideshow';

const sections = new ShopifySectionsManager();

```

### Registering a Section

You can then register each section in your theme as follows:

```js
// ThemeView.js

[...]

sections.register('dynamic-slideshow', section => new DynamicSlideshow(section));
```

The first argument passed to the `register` function is the section type.

The second argument should be the section handler. As each section is loaded, the appropriate section handler (identified by the script tag's `data-section-type` attribute in the Liquid markup) gets called and the section is initialized.

### Section Callback Parameters

The `section` argument passed to the section class's constructor is an `object` and may contain the following data:

Key | Type | Description
---|---|---
`el` | `HTMLElement` | The shopify section container specific to that section
`data` | `object` | Data passed to the javascript class from the [liquid markup](#liquid)
`id` | `string` | The section ID which may be a number assigned by Shopify (in the case of dynamic sections) or may match the section type (static sections)
`type` | `string` | The section type, as provided when registered
`postMessage` | `function` | A function that can be called to pass messages between sections. The function should be called with a message "name", and optionally some data.

### Event Handler Parameters

Arguments passed to shopify event functions such as `onSectionUnload()` and `onSectionBlockSelect()` are objects containing the following data:

Key | Type | Description
---|---|---
`el` | `HTMLElement` | The section (or section block) element
`id` | `string` | The section (or section block) id

### Example
```js
// dynamic-slideshow.js
export default class DynamicSlideshow {
    constructor(section) {
        this.el = section.el // Section container element generated by Shopify - all element selectors in the class should be scoped to section.el
        this.data = section.data // JSON contained within script tags in liquid file
    }

    onSectionUnload(section) {
        // Actions to be taken when the section is removed from the page
        // such as unbinding events
    }

    onSectionBlockSelect(block) {
      // Actions to be taken when a particular component of a section, such as a slideshow panel
      // is selected.
    }

    [...]
}
```

### Lazy Initialize Sections

For performance improvements you can lazy initialize sections by passing in an extra parameter when registering sections. The ` { lazy: true }` will ensure that the section Javascript only triggers when the section scrolls into view.

### Example

```js
sections.register('dynamic-featured-product', section => new DynamicFeaturedProduct(section), { lazy: true });
```
